#!/bin/sh
tm_startdate=`date`
tm_start=`date +%s`
top=/c2-mirror/c2sdk
mkdir -p $top
cd $top

if [ ! -d .repo/repo ]; then
    mkdir -p .repo;
    cd .repo;
    git clone ssh://git.bj.c2micro.com/c2sdk/repo.git;
    cd ..;
fi

if [ ! -d .repo/manifests ]; then
    repo init --mirror -u ssh://git.bj.c2micro.com/c2sdk/manifests.git -m allgits.xml
else
    repo sync >>mirror-sync.log 2>&1
fi

top=/c2-mirror/android
mkdir -p $top
cd $top

if [ ! -d .repo/repo ]; then
    mkdir -p .repo;
    cd .repo;
    git clone ssh://git.bj.c2micro.com/mentor-mirror/build/repo.git;
    cd ..;
fi

if [ ! -d .repo/manifests ]; then
    repo init --mirror -u ssh://git.bj.c2micro.com/mentor-mirror/build/manifests.git -b devel
else
    repo sync  >>mirror-sync.log 2>&1
fi


cd /c2-mirror
tm_done=`date +%s`
echo "$tm_startdate  ==> `date` : mirror sync c2sdk, android $((tm_done-tm_start)) seconds consumed." >>mirror-sync.log

n=`sed -n $= mirror-sync.log`
if [ $n -gt 20000 ];then
  t=$((n-10000))
  sed -i "1,$t d" mirror-sync.log
fi
